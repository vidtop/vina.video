TinyCore.Module.define("models_vidtop",[],function(){var e=lru(100);return{onStart:function(e){},getDataItem:function(e,o){var t=e+"."+o.id;return o.post={ID:t},o.href="#p/"+t,o.link="#p/"+t,o.content=o.text,o.post_id=t,o},getDataList:function(e,o){var t=this;t.getData(e,function(n){o(n.filter(function(e){return e}).map(function(o){return t.getDataItem(e,o)}))})},getPlayObj:function(e,o){console.log("getPlayObj:"+e);var t=this;if(e){var n=e.split("."),i=n[0],r=n[1];t.getData(i,function(e){console.log("_e2_:"),console.log(e);var n=e.filter(function(e){return e.id==r})[0];console.log("e2"),console.log(n),t.getDataPlayDetail(n,o)})}else o()},getDataPlayDetail:function(e,o){console.log("_e2222222"),console.log(e),this.getData(e.player,function(t){console.log("_e3333333"),console.log(t);var n=t.constructor===Array?t[0]:t;if("youtube"==e.src_type){var i=e.src_play;Object.assign(n.meta,{title:e.title,subTitle:e.subTitle}),Object.assign(n,{codes:["https://www.youtube.com/watch?v="+i],poster:"https://img.youtube.com/vi/"+i+"/maxresdefault.jpg",preview:{previewSeconds:"0",previewLink:"",previewTitle:"",previewDescription:""}}),n.options.youtube=1,n.options.code=e.src_play}console.log("_e3"),console.log(n),o(n)})},_getDataHandler:function(e,o,t,n){var i=e.filter(function(e){return e.status});n(t?i.filter(function(e){return e.id==t}):i)},getData:function(o,t){var n,i,r=this;if(/\./.test(o)){var a=o.split(".");n=a[1],i=a[0]}else i=o;var l="https://docs.google.com/spreadsheets/d/e/"+i+"/pub?output=csv",s=e.get(i);console.log("key1_cached:"+i),console.log(s),s?vidtop.config&&vidtop.config.player&&i==vidtop.config.player?r._getDataHandler(JSON.parse(s),o,n,t):r._getDataHandler(s,o,n,t):r._api(l,function(a){console.log("key1:"+i),console.log(a),vidtop.config&&vidtop.config.player&&i==vidtop.config.player?e.set(i,JSON.stringify(a)):e.set(i,a),r._getDataHandler(a,o,n,t)})},_csvJSON:function(e){for(var o=[],t=e[0],n=1;n<e.length;n++){for(var i,r={},a=e[n],l=0;l<t.length;l++)i=a[l],objectPath.set(r,t[l],i);o.push(r)}return o},_api:function(e,o){function t(e){e&&console.log(e),console.log("       Time:",a-c||"(Unknown; your browser does not support the Performance API)","ms")}function n(e){a=r(),t("Parse complete");var n=l._csvJSON(e.data);o(n)}function i(e,o){a=r(),console.log("ERROR:",e,o)}function r(){return void 0!==window.performance?window.performance.now():0}var a,l=this,s={delimiter:"",newline:"",quoteChar:'"',header:!1,dynamicTyping:!0,preview:0,encoding:"",worker:!1,comments:!1,skipEmptyLines:!1,chunk:void 0,fastMode:void 0,beforeFirstChunk:void 0,withCredentials:void 0,step:void 0,complete:n,error:i,download:!0},c=r();Papa.parse(e,s)}}});